{% include base_path %}

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button>
          <div class="navicon"></div>
        </button>
        <button>
          <div class="navicon"></div>
        </button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="{{ base_path }}/">{{ site.title }}</a></li>
          {% for link in site.data.navigation.main %}
            {% if link.url contains 'http' %}
            {% assign domain = '' %}
            {% else %}
            {% assign domain = base_path %}
            {% endif %}
            <li class="masthead__menu-item"><a href="{{ domain }}{{ link.url }}">{{ link.title }}</a></li>
          {% endfor %}
          <!-- 语言切换器 -->
          <li class="masthead__menu-item">
            <div class="lang-switcher">
              <a href="#" class="lang-trigger">
                <i class="fas fa-globe"></i>
              </a>
              <div class="lang-dropdown">
                <a href="#" data-lang="en" {% if page.lang=='en' or page.lang==nil %}class="active"{% endif %}>English</a>
                <a href="#" data-lang="zh" {% if page.lang=='zh' %}class="active"{% endif %}>中文</a>
              </div>
            </div>
          </li>
          <li id="theme-toggle" class="masthead__menu-item persist tail">
            <a><i id="theme-icon" class="fa-solid fa-sun" aria-hidden="true" title="toggle theme"></i></a>
          </li>
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
<script>
  // 内联的语言切换函数，确保即使外部脚本未加载也能工作
  function switchToLang(lang) {
    console.log('Inline switch to language:', lang);

    var currentPath = window.location.pathname;
    var newPath;

    if (lang === 'zh' && !currentPath.startsWith('/zh/')) {
      newPath = currentPath === '/' || currentPath === '' ? '/zh/' : '/zh' + currentPath;
      window.location.href = newPath;
    }
    else if (lang === 'en' && currentPath.startsWith('/zh/')) {
      newPath = currentPath.replace('/zh/', '/');
      window.location.href = newPath;
    }

    localStorage.setItem('preferredLanguage', lang);
    return false;
  }
</script>
</div>
</div>